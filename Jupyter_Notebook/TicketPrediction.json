{"paragraphs":[{"text":"import org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.functions._\nimport org.apache.spark.sql.types.IntegerType\nimport org.apache.spark.ml.linalg.Vectors\nimport org.apache.spark.ml.{Pipeline, PipelineModel}\nimport org.apache.spark.ml.tuning.{ParamGridBuilder, CrossValidator}\n//import org.apache.spark.ml.feature.{Imputer, ImputerModel}\nimport org.apache.spark.sql.{SQLContext, Row, DataFrame, Column}\nimport org.apache.spark.ml.feature.{OneHotEncoder, StringIndexer, IndexToString} \nimport org.apache.spark.ml.feature.{VectorAssembler, VectorIndexer}\nimport org.apache.spark.ml.feature.{Bucketizer,Normalizer}\nimport org.apache.spark.ml.evaluation.BinaryClassificationEvaluator\n//import ml.dmlc.xgboost4j.scala.spark.{XGBoostEstimator, XGBoostClassificationModel}\nimport scala.collection.mutable\n\nval PATH = \"file:///Users/zacha/Desktop/Projects/TicketPrediction/\"\n\n//load the data\nval training_df = spark.read.option(\"header\",\"true\").format(\"csv\").load(PATH + \"TRAINING_Traffic_Stops__drivers.csv\")\n\nval raw_cols = Seq(\"ADDRESS_X\",\"LATITUDE_X\",\"LONGITUDE_X\",\"AGENCY\",\"DISPOSITION_TEXT\", \"EVENT_NUMBER\", \"INCIDENT_TYPE_DESC\", \"INCIDENT_TYPE_ID\", \"ACTIONTAKENCID\",\"ACTIONTAKENCIDID\",\"NEIGHBORHOOD\",\"PRIORITY_\",\"INSTANCE_ID\",\"IS_JUVENILE\",\"INTERVIEW_NUMBER\",\"INTERVIEW_DATE\", \"VEHICLE_MAKE\",\"VEHICLE_MODEL\",\"VEHICLE_YEAR\",\"CONTACT_TYPE_CID\",\"LICENSE_PLATE_STATE\",\"OFFICER_ASSIGNMENT\", \"REPORT_TYPE_CID\",\"SEX\",\"RACE\",\"AGE\",\"FIELD_SUBJECT_CID\",\"AGE_RANGE_CID\",\"BEAT\")\n\nval age_splits = Array(16.0,26.0,36.0,46.0,56.0,66.0,76.0,86.0,96.0)\nval features = Array(\"Road\",\"Ticketed\",\"Time\",\"ACURA\", \"ALZ\", \"AUDI\", \"BMW\", \"BUICK\",\"CADILLAC\", \"CHEVY\", \"CHRYSLER\", \"DENA\", \"DODGE\", \"FIAT\", \"FORD\", \"SEMI\", \"GMC\", \"GEO\", \"HONDA\", \"HUMMER\", \"HYUNDAI\", \"INFINITY\",\"ISUZU\",\"JAGUAR\",\"JEEP\",\"KIA\",\"LAND\",\"LEXUS\",\"LINCOLN\",\"MAZDA\",\"MERCURY\",\"MERCEDES\",\"MINI\",\"MITZUBISHI\",\"NISSAN\",\"OLDSMOBILE\",\"PLYMOUTH\",\"PONTIAC\",\"PORSCHE\",\"SAAB\",\"SATURN\", \"SCION\",\"SUBARU\",\"SUZUKI\",\"TOYOTA\",\"VOLKWAGON\",\"VOLVO\",\"YAMAMHA\",\"OTHER_MAKE\",\"CarYear\",\"CarPlateState\",\"SexE\",\"RaceE\",\"AgeE\")\n\n/*\nFeatures Data Frame Columns\n#   Address (Road)\n#   Action Taken Id (Citation | No Citation)\n#   Date (Time) \n#   Vehicle Make \n#   Vehicle Model \n#   Vehicle Year \n#   License Plate State \n#   Sex\n#   Race \n#   Age range\n*/\nval featureFrame = (\n    training_df\n        .withColumn(\"Road\",regexp_extract($\"ADDRESS_X\",raw\"X[\\s]+([A-Z0-9]+[A-Z0-9\\s]*)\",1))\n        .withColumn(\"Ticketed\", when($\"ACTIONTAKENCIDID\" === 3,1).otherwise(0))\n        .withColumn(\"Time\", regexp_extract($\"INTERVIEW_DATE\",(raw\"([\\d]{2}:[\\d]{2}:[\\d]{2}\\s[A-Z]{2})\"),1))\n        .withColumn(\"ACURA\", when($\"VEHICLE_MAKE\" === \"ACCR\" or\n            $\"VEHICLE_MAKE\" === \"ACCU\" or\n            $\"VEHICLE_MAKE\" === \"ACUR\" or\n            $\"VEHICLE_MAKE\" === \"ACURA\" or\n            $\"VEHICLE_MAKE\" === \"ALUR\", 1).otherwise(0))\n\n        .withColumn(\"ALZ\", when($\"VEHICLE_MAKE\" === \"ALZ\", 1).otherwise(0))\n        \n        .withColumn(\"AUDI\", when($\"VEHICLE_MAKE\" === \"AUDI\", 1).otherwise(0))\n        \n        .withColumn(\"BMW\", when($\"VEHIClE_MAKE\" === \"BMW\", 1).otherwise(0))\n        \n        .withColumn(\"BUICK\", when($\"VEHICLE_MAKE\" === \"BUIC\" or\n            $\"VEHICLE_MAKE\" === \"BUICK\", 1).otherwise(0))\n        \n        .withColumn(\"CADILLAC\", when($\"VEHIClE_MAKE\" === \"CADI\" or\n            $\"VEHIClE_MAKE\" === \"CADILLAC\", 1).otherwise(0))\n        \n        .withColumn(\"CHEVY\", when($\"VEHIClE_MAKE\" === \"CGEV\" or\n            $\"VEHIClE_MAKE\" === \"CHE\" or\n            $\"VEHIClE_MAKE\" === \"CHEV\" or\n            $\"VEHIClE_MAKE\" === \"CHEVEROLET\" or\n            $\"VEHIClE_MAKE\" === \"CHEVI\" or\n            $\"VEHIClE_MAKE\" === \"CHEVROLET\" or\n            $\"VEHIClE_MAKE\" === \"CHEVY\" or\n            $\"VEHIClE_MAKE\" === \"CHVY\", 1).otherwise(0))\n\n        .withColumn(\"CHRYSLER\", when($\"VEHICLE_MAKE\" === \"CHRY\" or\n            $\"VEHICLE_MAKE\" === \"CHRYS\" or\n            $\"VEHIClE_MAKE\" === \"CHRYSLER\" or\n            $\"VEHIClE_MAKE\" === \"CRY\" or\n            $\"VEHIClE_MAKE\" === \"PT\", 1).otherwise(0))\n        \n        .withColumn(\"DENA\", when($\"VEHIClE_MAKE\" === \"DENA\", 1).otherwise(0))\n        \n        .withColumn(\"DODGE\", when($\"VEHIClE_MAKE\" === \"DODG\" or\n            $\"VEHIClE_MAKE\" === \"DODGE\", 1).otherwise(0))\n        \n        .withColumn(\"FIAT\", when($\"VEHICLE_MAKE\" === \"FIAT\", 1).otherwise(0))\n        \n        .withColumn(\"FORD\", when($\"VEHIClE_MAKE\" === \"FORD\", 1).otherwise(0))\n        \n        .withColumn(\"SEMI\", when($\"VEHIClE_MAKE\" === \"FREIGHT\" or\n            $\"VEHIClE_MAKE\" === \"FRHT\" or\n            $\"VEHIClE_MAKE\" === \"MACK\", 1).otherwise(0))\n        \n        .withColumn(\"GMC\", when($\"VEHICLE_MAKE\" === \"GENERAL MOTORS CORP.\" or\n            $\"VEHIClE_MAKE\" === \"GMC\", 1).otherwise(0))\n        \n        .withColumn(\"GEO\", when($\"VEHIClE_MAKE\" === \"GEO\", 1).otherwise(0))\n        \n        .withColumn(\"HONDA\", when($\"VEHIClE_MAKE\" === \"HON\" or\n            $\"VEHIClE_MAKE\" === \"HOND\" or\n            $\"VEHIClE_MAKE\" === \"HONDA\", 1).otherwise(0))\n        \n        .withColumn(\"HUMMER\", when($\"VEHIClE_MAKE\" === \"HUMM\", 1).otherwise(0))\n        \n        .withColumn(\"HYUNDAI\", when($\"VEHIClE_MAKE\" === \"HUYU\" or\n            $\"VEHIClE_MAKE\" === \"HYAN\" or\n            $\"VEHIClE_MAKE\" === \"HYND\" or\n            $\"VEHIClE_MAKE\" === \"HYUA\" or\n            $\"VEHIClE_MAKE\" === \"HYUN\" or\n            $\"VEHIClE_MAKE\" === \"HYUND\" or\n            $\"VEHIClE_MAKE\" === \"HYUNDAI\", 1).otherwise(0))\n\n        .withColumn(\"INFINITY\", when($\"VEHIClE_MAKE\" === \"INFI\" or\n            $\"VEHIClE_MAKE\" === \"INFIN\" or\n            $\"VEHIClE_MAKE\" === \"INFINITI\" or\n            $\"VEHIClE_MAKE\" === \"INFINITY\", 1).otherwise(0))\n        \n        .withColumn(\"ISUZU\", when($\"VEHICLE_MAKE\" === \"ISUZ\", 1).otherwise(0))\n        \n        .withColumn(\"JAGUAR\", when($\"VEHIClE_MAKE\" === \"JAG\" or\n            $\"VEHIClE_MAKE\" === \"JAGU\", 1).otherwise(0))\n        \n        .withColumn(\"JEEP\", when($\"VEHIClE_MAKE\" === \"JEEP\", 1).otherwise(0))\n        \n        .withColumn(\"KIA\", when($\"VEHIClE_MAKE\" === \"KIA\" or\n            $\"VEHIClE_MAKE\" === \"KIA FORT\" or\n            $\"VEHICLE_MAKE\" === \"KIA MOTORS CORP.\", 1).otherwise(0))\n        \n        .withColumn(\"LAND\", when($\"VEHIClE_MAKE\" === \"LAND\", 1).otherwise(0))\n        \n        .withColumn(\"LEXUS\", when($\"VEHIClE_MAKE\" === \"LEXI\" or\n            $\"VEHIClE_MAKE\" === \"LEXS\" or\n            $\"VEHIClE_MAKE\" === \"LEXU\" or\n            $\"VEHIClE_MAKE\" === \"LEXUS\", 1).otherwise(0))\n        \n        .withColumn(\"LINCOLN\", when($\"VEHIClE_MAKE\" === \"LINC\" or\n            $\"VEHIClE_MAKE\" === \"LINCOLN\" or\n            $\"VEHIClE_MAKE\" === \"LINCOLN / LINCOLN-CONTINENTAL\", 1).otherwise(0))\n        \n        .withColumn(\"MAZDA\", when($\"VEHIClE_MAKE\" === \"MADZ\" or\n            $\"VEHIClE_MAKE\" === \"MAZ\" or\n            $\"VEHIClE_MAKE\" === \"MAZD\" or\n            $\"VEHIClE_MAKE\" === \"MAZDA\", 1).otherwise(0))\n\n        .withColumn(\"MERCURY\", when($\"VEHIClE_MAKE\" === \"MECR\" or\n            $\"VEHIClE_MAKE\" === \"MERC\" or\n            $\"VEHIClE_MAKE\" === \"MERCURY\" or\n            $\"VEHIClE_MAKE\" === \"MERG\", 1).otherwise(0))\n        \n        .withColumn(\"MERCEDES\", when($\"VEHIClE_MAKE\" === \"MERCEDES\" or\n            $\"VEHIClE_MAKE\" === \"MERZ\", 1).otherwise(0))\n        \n        .withColumn(\"MINI\", when($\"VEHIClE_MAKE\" === \"MINI\", 1).otherwise(0))\n        \n        .withColumn(\"MITSUBISHI\", when($\"VEHIClE_MAKE\" === \"MITI\" or\n            $\"VEHIClE_MAKE\" === \"MITS\" or\n            $\"VEHIClE_MAKE\" === \"MITSUBISHI\" or\n            $\"VEHIClE_MAKE\" === \"MITZ\", 1).otherwise(0))\n        \n        .withColumn(\"NISSAN\", when($\"VEHIClE_MAKE\" === \"NISS\" or\n            $\"VEHIClE_MAKE\" === \"NISSAN\" or\n            $\"VEHIClE_MAKE\" === \"NISSIAN\", 1).otherwise(0))\n        \n        .withColumn(\"OLDSMOBILE\", when($\"VEHIClE_MAKE\" === \"OLDS\" or\n            $\"VEHIClE_MAKE\" === \"OLDSMOBILE\", 1).otherwise(0))\n        \n        .withColumn(\"PLYMOUTH\", when($\"VEHIClE_MAKE\" === \"PLYM\", 1).otherwise(0))\n        \n        .withColumn(\"PONTIAC\", when($\"VEHIClE_MAKE\" === \"PONT\" or\n            $\"VEHIClE_MAKE\" === \"PONTAIC\" or\n            $\"VEHIClE_MAKE\" === \"PONTIAC\", 1).otherwise(0))\n        \n        .withColumn(\"PORSCHE\", when($\"VEHIClE_MAKE\" === \"PORS\" or\n            $\"VEHIClE_MAKE\" === \"PORSCHE\", 1).otherwise(0))\n        \n        .withColumn(\"SAAB\", when($\"VEHIClE_MAKE\" === \"SAAB\", 1).otherwise(0))\n\n        .withColumn(\"SATURN\", when($\"VEHIClE_MAKE\" === \"sATR\" or\n            $\"VEHIClE_MAKE\" === \"SATU\" or\n            $\"VEHIClE_MAKE\" === \"SATURN\" or\n            $\"VEHIClE_MAKE\" === \"STRN\", 1).otherwise(0))\n        \n        .withColumn(\"SCION\", when($\"VEHIClE_MAKE\" === \"SCIO\" or\n            $\"VEHIClE_MAKE\" === \"SCION\", 1).otherwise(0))\n        \n        .withColumn(\"SUBARU\", when($\"VEHIClE_MAKE\" === \"SUB\" or\n            $\"VEHIClE_MAKE\" === \"SUBA\" or\n            $\"VEHIClE_MAKE\" === \"SUBU\", 1).otherwise(0))\n        \n        .withColumn(\"SUZUKI\", when($\"VEHIClE_MAKE\" === \"SUZI\" or\n            $\"VEHIClE_MAKE\" === \"SUZK\" or\n            $\"VEHIClE_MAKE\" === \"SUZU\", 1).otherwise(0))\n        \n        .withColumn(\"TOYOTA\", when($\"VEHIClE_MAKE\" === \"TOYA\" or\n            $\"VEHIClE_MAKE\" === \"TOYO\" or\n            $\"VEHIClE_MAKE\" === \"TOYOTA\" or\n            $\"VEHIClE_MAKE\" === \"TOYT\", 1).otherwise(0))\n        \n        .withColumn(\"VOLKSWAGON\", when($\"VEHIClE_MAKE\" === \"VOLK\" or\n            $\"VEHIClE_MAKE\" === \"VOLKS\" or\n            $\"VEHIClE_MAKE\" === \"VOLKSWAGEN\" or\n            $\"VEHIClE_MAKE\" === \"VOLKSWAGEN / VOLKSWAGON\" or\n            $\"VEHIClE_MAKE\" === \"VW\", 1).otherwise(0))\n        \n        .withColumn(\"VOLVO\", when($\"VEHIClE_MAKE\" === \"VOLV\", 1).otherwise(0))\n        \n        .withColumn(\"YAMAHA\", when($\"VEHIClE_MAKE\" === \"YAMA\", 1).otherwise(0))\n        \n        .withColumn(\"OTHER_MAKE\", when($\"VEHICLE_MAKE\" === \"\", 1).otherwise(0))\n         \n                .withColumn(\"CarYear\",$\"VEHICLE_YEAR\")\n                .withColumn(\"CarPlateState\",$\"LICENSE_PLATE_STATE\")\n                .withColumn(\"SexE\", $\"SEX\")\n                .withColumn(\"RaceE\", $\"RACE\")\n        )\n\nval age_bucketize = new Bucketizer().setInputCol(\"AGE\").setOutputCol(\"AgeE\").setSplits(age_splits)\nval assembler = new VectorAssembler().setInputCols(features).setOutputCols(\"features\")\n\nfeatureFrame.drop(\"ADDRESS_X\",\"LATITUDE_X\",\"LONGITUDE_X\",\"AGENCY\",\"DISPOSITION_TEXT\", \"EVENT_NUMBER\", \"INCIDENT_TYPE_DESC\", \"INCIDENT_TYPE_ID\", \"ACTIONTAKENCID\",\"ACTIONTAKENCIDID\",\"NEIGHBORHOOD\",\"PRIORITY_\",\"INSTANCE_ID\",\"IS_JUVENILE\",\"INTERVIEW_NUMBER\",\"INTERVIEW_DATE\", \"VEHICLE_MAKE\",\"VEHICLE_MODEL\",\"VEHICLE_YEAR\",\"CONTACT_TYPE_CID\",\"LICENSE_PLATE_STATE\",\"OFFICER_ASSIGNMENT\", \"REPORT_TYPE_CID\",\"SEX\",\"RACE\",\"AGE\",\"FIELD_SUBJECT_CID\",\"AGE_RANGE_CID\",\"BEAT\").show()\n\n","user":"anonymous","dateUpdated":"2017-08-27T02:38:12-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","tableHide":false,"lineNumbers":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"msg":[{"data":"","type":"TEXT"}]},"apps":[],"jobName":"paragraph_1503798307334_556390656","id":"20170826-214507_1908324424","dateCreated":"2017-08-26T21:45:07-0400","dateStarted":"2017-08-27T02:38:01-0400","dateFinished":"2017-08-27T02:35:28-0400","status":"RUNNING","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2079","errorMessage":""},{"text":"val i = \"hi\"\nprint(i)\n","user":"anonymous","dateUpdated":"2017-08-27T02:05:54-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ni: String = hi\nhi"}]},"apps":[],"jobName":"paragraph_1503800769383_994532044","id":"20170826-222609_904774148","dateCreated":"2017-08-26T22:26:09-0400","dateStarted":"2017-08-27T00:30:02-0400","dateFinished":"2017-08-27T00:30:11-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2080"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1503807060180_-1403829564","id":"20170827-001100_1485738311","dateCreated":"2017-08-27T00:11:00-0400","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:2081","dateUpdated":"2017-08-27T02:05:54-0400"}],"name":"TicketPrediction","id":"2CSRQRET3","angularObjects":{"2CTQA8H9H:shared_process":[],"2CS12W3HZ:shared_process":[],"2CRB9NP2H:shared_process":[],"2CSTGQ6B9:shared_process":[],"2CTH8QUU8:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}